var AttributionTracker=function(){"use strict";let t;const e=new Uint8Array(16);function i(){if(!t&&(t="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!t))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return t(e)}const r=[];for(let t=0;t<256;++t)r.push((t+256).toString(16).slice(1));var s={randomUUID:"undefined"!=typeof crypto&&crypto.randomUUID&&crypto.randomUUID.bind(crypto)};function n(t,e,n){if(s.randomUUID&&!e&&!t)return s.randomUUID();const o=(t=t||{}).random||(t.rng||i)();return o[6]=15&o[6]|64,o[8]=63&o[8]|128,function(t,e=0){return r[t[e+0]]+r[t[e+1]]+r[t[e+2]]+r[t[e+3]]+"-"+r[t[e+4]]+r[t[e+5]]+"-"+r[t[e+6]]+r[t[e+7]]+"-"+r[t[e+8]]+r[t[e+9]]+"-"+r[t[e+10]]+r[t[e+11]]+r[t[e+12]]+r[t[e+13]]+r[t[e+14]]+r[t[e+15]]}(o)}
/**
   * [js-sha256]{@link https://github.com/emn178/js-sha256}
   *
   * @version 0.11.0
   * @author Chen, Yi-Cyuan [emn178@gmail.com]
   * @copyright Chen, Yi-Cyuan 2014-2024
   * @license MIT
   */
/*! js-cookie v3.0.5 | MIT */
function o(t){for(var e=1;e<arguments.length;e++){var i=arguments[e];for(var r in i)t[r]=i[r]}return t}!function(){var t="input is invalid type",e="object"==typeof window,i=e?window:{};i.JS_SHA256_NO_WINDOW&&(e=!1);var r=!e&&"object"==typeof self,s=!i.JS_SHA256_NO_NODE_JS&&"object"==typeof process&&process.versions&&process.versions.node;s?i=global:r&&(i=self);var n=!i.JS_SHA256_NO_COMMON_JS&&"object"==typeof module&&module.exports,o="function"==typeof define&&define.amd,h=!i.JS_SHA256_NO_ARRAY_BUFFER&&"undefined"!=typeof ArrayBuffer,a="0123456789abcdef".split(""),c=[-2147483648,8388608,32768,128],u=[24,16,8,0],l=[1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298],f=["hex","array","digest","arrayBuffer"],d=[];!i.JS_SHA256_NO_NODE_JS&&Array.isArray||(Array.isArray=function(t){return"[object Array]"===Object.prototype.toString.call(t)}),!h||!i.JS_SHA256_NO_ARRAY_BUFFER_IS_VIEW&&ArrayBuffer.isView||(ArrayBuffer.isView=function(t){return"object"==typeof t&&t.buffer&&t.buffer.constructor===ArrayBuffer});var p=function(t,e){return function(i){return new b(e,!0).update(i)[t]()}},y=function(t){var e=p("hex",t);s&&(e=g(e,t)),e.create=function(){return new b(t)},e.update=function(t){return e.create().update(t)};for(var i=0;i<f.length;++i){var r=f[i];e[r]=p(r,t)}return e},g=function(e,r){var s,n=require("crypto"),o=require("buffer").Buffer,h=r?"sha224":"sha256";s=o.from&&!i.JS_SHA256_NO_BUFFER_FROM?o.from:function(t){return new o(t)};return function(i){if("string"==typeof i)return n.createHash(h).update(i,"utf8").digest("hex");if(null==i)throw new Error(t);return i.constructor===ArrayBuffer&&(i=new Uint8Array(i)),Array.isArray(i)||ArrayBuffer.isView(i)||i.constructor===o?n.createHash(h).update(s(i)).digest("hex"):e(i)}},v=function(t,e){return function(i,r){return new w(i,e,!0).update(r)[t]()}},m=function(t){var e=v("hex",t);e.create=function(e){return new w(e,t)},e.update=function(t,i){return e.create(t).update(i)};for(var i=0;i<f.length;++i){var r=f[i];e[r]=v(r,t)}return e};function b(t,e){e?(d[0]=d[16]=d[1]=d[2]=d[3]=d[4]=d[5]=d[6]=d[7]=d[8]=d[9]=d[10]=d[11]=d[12]=d[13]=d[14]=d[15]=0,this.blocks=d):this.blocks=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],t?(this.h0=3238371032,this.h1=914150663,this.h2=812702999,this.h3=4144912697,this.h4=4290775857,this.h5=1750603025,this.h6=1694076839,this.h7=3204075428):(this.h0=1779033703,this.h1=3144134277,this.h2=1013904242,this.h3=2773480762,this.h4=1359893119,this.h5=2600822924,this.h6=528734635,this.h7=1541459225),this.block=this.start=this.bytes=this.hBytes=0,this.finalized=this.hashed=!1,this.first=!0,this.is224=t}function w(e,i,r){var s,n=typeof e;if("string"===n){var o,a=[],c=e.length,u=0;for(s=0;s<c;++s)(o=e.charCodeAt(s))<128?a[u++]=o:o<2048?(a[u++]=192|o>>>6,a[u++]=128|63&o):o<55296||o>=57344?(a[u++]=224|o>>>12,a[u++]=128|o>>>6&63,a[u++]=128|63&o):(o=65536+((1023&o)<<10|1023&e.charCodeAt(++s)),a[u++]=240|o>>>18,a[u++]=128|o>>>12&63,a[u++]=128|o>>>6&63,a[u++]=128|63&o);e=a}else{if("object"!==n)throw new Error(t);if(null===e)throw new Error(t);if(h&&e.constructor===ArrayBuffer)e=new Uint8Array(e);else if(!(Array.isArray(e)||h&&ArrayBuffer.isView(e)))throw new Error(t)}e.length>64&&(e=new b(i,!0).update(e).array());var l=[],f=[];for(s=0;s<64;++s){var d=e[s]||0;l[s]=92^d,f[s]=54^d}b.call(this,i,r),this.update(f),this.oKeyPad=l,this.inner=!0,this.sharedMemory=r}b.prototype.update=function(e){if(!this.finalized){var i,r=typeof e;if("string"!==r){if("object"!==r)throw new Error(t);if(null===e)throw new Error(t);if(h&&e.constructor===ArrayBuffer)e=new Uint8Array(e);else if(!(Array.isArray(e)||h&&ArrayBuffer.isView(e)))throw new Error(t);i=!0}for(var s,n,o=0,a=e.length,c=this.blocks;o<a;){if(this.hashed&&(this.hashed=!1,c[0]=this.block,this.block=c[16]=c[1]=c[2]=c[3]=c[4]=c[5]=c[6]=c[7]=c[8]=c[9]=c[10]=c[11]=c[12]=c[13]=c[14]=c[15]=0),i)for(n=this.start;o<a&&n<64;++o)c[n>>>2]|=e[o]<<u[3&n++];else for(n=this.start;o<a&&n<64;++o)(s=e.charCodeAt(o))<128?c[n>>>2]|=s<<u[3&n++]:s<2048?(c[n>>>2]|=(192|s>>>6)<<u[3&n++],c[n>>>2]|=(128|63&s)<<u[3&n++]):s<55296||s>=57344?(c[n>>>2]|=(224|s>>>12)<<u[3&n++],c[n>>>2]|=(128|s>>>6&63)<<u[3&n++],c[n>>>2]|=(128|63&s)<<u[3&n++]):(s=65536+((1023&s)<<10|1023&e.charCodeAt(++o)),c[n>>>2]|=(240|s>>>18)<<u[3&n++],c[n>>>2]|=(128|s>>>12&63)<<u[3&n++],c[n>>>2]|=(128|s>>>6&63)<<u[3&n++],c[n>>>2]|=(128|63&s)<<u[3&n++]);this.lastByteIndex=n,this.bytes+=n-this.start,n>=64?(this.block=c[16],this.start=n-64,this.hash(),this.hashed=!0):this.start=n}return this.bytes>4294967295&&(this.hBytes+=this.bytes/4294967296|0,this.bytes=this.bytes%4294967296),this}},b.prototype.finalize=function(){if(!this.finalized){this.finalized=!0;var t=this.blocks,e=this.lastByteIndex;t[16]=this.block,t[e>>>2]|=c[3&e],this.block=t[16],e>=56&&(this.hashed||this.hash(),t[0]=this.block,t[16]=t[1]=t[2]=t[3]=t[4]=t[5]=t[6]=t[7]=t[8]=t[9]=t[10]=t[11]=t[12]=t[13]=t[14]=t[15]=0),t[14]=this.hBytes<<3|this.bytes>>>29,t[15]=this.bytes<<3,this.hash()}},b.prototype.hash=function(){var t,e,i,r,s,n,o,h,a,c=this.h0,u=this.h1,f=this.h2,d=this.h3,p=this.h4,y=this.h5,g=this.h6,v=this.h7,m=this.blocks;for(t=16;t<64;++t)e=((s=m[t-15])>>>7|s<<25)^(s>>>18|s<<14)^s>>>3,i=((s=m[t-2])>>>17|s<<15)^(s>>>19|s<<13)^s>>>10,m[t]=m[t-16]+e+m[t-7]+i|0;for(a=u&f,t=0;t<64;t+=4)this.first?(this.is224?(n=300032,v=(s=m[0]-1413257819)-150054599|0,d=s+24177077|0):(n=704751109,v=(s=m[0]-210244248)-1521486534|0,d=s+143694565|0),this.first=!1):(e=(c>>>2|c<<30)^(c>>>13|c<<19)^(c>>>22|c<<10),r=(n=c&u)^c&f^a,v=d+(s=v+(i=(p>>>6|p<<26)^(p>>>11|p<<21)^(p>>>25|p<<7))+(p&y^~p&g)+l[t]+m[t])|0,d=s+(e+r)|0),e=(d>>>2|d<<30)^(d>>>13|d<<19)^(d>>>22|d<<10),r=(o=d&c)^d&u^n,g=f+(s=g+(i=(v>>>6|v<<26)^(v>>>11|v<<21)^(v>>>25|v<<7))+(v&p^~v&y)+l[t+1]+m[t+1])|0,e=((f=s+(e+r)|0)>>>2|f<<30)^(f>>>13|f<<19)^(f>>>22|f<<10),r=(h=f&d)^f&c^o,y=u+(s=y+(i=(g>>>6|g<<26)^(g>>>11|g<<21)^(g>>>25|g<<7))+(g&v^~g&p)+l[t+2]+m[t+2])|0,e=((u=s+(e+r)|0)>>>2|u<<30)^(u>>>13|u<<19)^(u>>>22|u<<10),r=(a=u&f)^u&d^h,p=c+(s=p+(i=(y>>>6|y<<26)^(y>>>11|y<<21)^(y>>>25|y<<7))+(y&g^~y&v)+l[t+3]+m[t+3])|0,c=s+(e+r)|0,this.chromeBugWorkAround=!0;this.h0=this.h0+c|0,this.h1=this.h1+u|0,this.h2=this.h2+f|0,this.h3=this.h3+d|0,this.h4=this.h4+p|0,this.h5=this.h5+y|0,this.h6=this.h6+g|0,this.h7=this.h7+v|0},b.prototype.hex=function(){this.finalize();var t=this.h0,e=this.h1,i=this.h2,r=this.h3,s=this.h4,n=this.h5,o=this.h6,h=this.h7,c=a[t>>>28&15]+a[t>>>24&15]+a[t>>>20&15]+a[t>>>16&15]+a[t>>>12&15]+a[t>>>8&15]+a[t>>>4&15]+a[15&t]+a[e>>>28&15]+a[e>>>24&15]+a[e>>>20&15]+a[e>>>16&15]+a[e>>>12&15]+a[e>>>8&15]+a[e>>>4&15]+a[15&e]+a[i>>>28&15]+a[i>>>24&15]+a[i>>>20&15]+a[i>>>16&15]+a[i>>>12&15]+a[i>>>8&15]+a[i>>>4&15]+a[15&i]+a[r>>>28&15]+a[r>>>24&15]+a[r>>>20&15]+a[r>>>16&15]+a[r>>>12&15]+a[r>>>8&15]+a[r>>>4&15]+a[15&r]+a[s>>>28&15]+a[s>>>24&15]+a[s>>>20&15]+a[s>>>16&15]+a[s>>>12&15]+a[s>>>8&15]+a[s>>>4&15]+a[15&s]+a[n>>>28&15]+a[n>>>24&15]+a[n>>>20&15]+a[n>>>16&15]+a[n>>>12&15]+a[n>>>8&15]+a[n>>>4&15]+a[15&n]+a[o>>>28&15]+a[o>>>24&15]+a[o>>>20&15]+a[o>>>16&15]+a[o>>>12&15]+a[o>>>8&15]+a[o>>>4&15]+a[15&o];return this.is224||(c+=a[h>>>28&15]+a[h>>>24&15]+a[h>>>20&15]+a[h>>>16&15]+a[h>>>12&15]+a[h>>>8&15]+a[h>>>4&15]+a[15&h]),c},b.prototype.toString=b.prototype.hex,b.prototype.digest=function(){this.finalize();var t=this.h0,e=this.h1,i=this.h2,r=this.h3,s=this.h4,n=this.h5,o=this.h6,h=this.h7,a=[t>>>24&255,t>>>16&255,t>>>8&255,255&t,e>>>24&255,e>>>16&255,e>>>8&255,255&e,i>>>24&255,i>>>16&255,i>>>8&255,255&i,r>>>24&255,r>>>16&255,r>>>8&255,255&r,s>>>24&255,s>>>16&255,s>>>8&255,255&s,n>>>24&255,n>>>16&255,n>>>8&255,255&n,o>>>24&255,o>>>16&255,o>>>8&255,255&o];return this.is224||a.push(h>>>24&255,h>>>16&255,h>>>8&255,255&h),a},b.prototype.array=b.prototype.digest,b.prototype.arrayBuffer=function(){this.finalize();var t=new ArrayBuffer(this.is224?28:32),e=new DataView(t);return e.setUint32(0,this.h0),e.setUint32(4,this.h1),e.setUint32(8,this.h2),e.setUint32(12,this.h3),e.setUint32(16,this.h4),e.setUint32(20,this.h5),e.setUint32(24,this.h6),this.is224||e.setUint32(28,this.h7),t},w.prototype=new b,w.prototype.finalize=function(){if(b.prototype.finalize.call(this),this.inner){this.inner=!1;var t=this.array();b.call(this,this.is224,this.sharedMemory),this.update(this.oKeyPad),this.update(t),b.prototype.finalize.call(this)}};var k=y();k.sha256=k,k.sha224=y(!0),k.sha256.hmac=m(),k.sha224.hmac=m(!0),n?module.exports=k:(i.sha256=k.sha256,i.sha224=k.sha224,o&&define((function(){return k})))}();var h=function t(e,i){function r(t,r,s){if("undefined"!=typeof document){"number"==typeof(s=o({},i,s)).expires&&(s.expires=new Date(Date.now()+864e5*s.expires)),s.expires&&(s.expires=s.expires.toUTCString()),t=encodeURIComponent(t).replace(/%(2[346B]|5E|60|7C)/g,decodeURIComponent).replace(/[()]/g,escape);var n="";for(var h in s)s[h]&&(n+="; "+h,!0!==s[h]&&(n+="="+s[h].split(";")[0]));return document.cookie=t+"="+e.write(r,t)+n}}return Object.create({set:r,get:function(t){if("undefined"!=typeof document&&(!arguments.length||t)){for(var i=document.cookie?document.cookie.split("; "):[],r={},s=0;s<i.length;s++){var n=i[s].split("="),o=n.slice(1).join("=");try{var h=decodeURIComponent(n[0]);if(r[h]=e.read(o,h),t===h)break}catch(t){}}return t?r[t]:r}},remove:function(t,e){r(t,"",o({},e,{expires:-1}))},withAttributes:function(e){return t(this.converter,o({},this.attributes,e))},withConverter:function(e){return t(o({},this.converter,e),this.attributes)}},{attributes:{value:Object.freeze(i)},converter:{value:Object.freeze(e)}})}({read:function(t){return'"'===t[0]&&(t=t.slice(1,-1)),t.replace(/(%[\dA-F]{2})+/gi,decodeURIComponent)},write:function(t){return encodeURIComponent(t).replace(/%(2[346BF]|3[AC-F]|40|5[BDE]|60|7[BCD])/g,decodeURIComponent)}},{path:"/"});const a="gtracker_",c=`${a}visitor_id`,u=`${a}consent_given`,l="https://ucczkgrnxvhxgnvrityk.supabase.co/functions/v1/event-capture";const f=new class{constructor(){Object.defineProperty(this,"clientId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"visitorId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"utmParams",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"clickIds",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"hasConsent",{enumerable:!0,configurable:!0,writable:!0,value:!1}),console.log("AttributionTracker initializing...");const t=this.getClientId();if(!t)throw new Error("Client ID is required. Add data-client-id attribute to the script tag.");console.log("Client ID:",t),this.clientId=t,this.checkConsent(),this.visitorId=this.getOrCreateVisitorId(),console.log("Visitor ID:",this.visitorId),this.captureUrlParams(),this.setupFormListeners(),this.trackPageView()}getClientId(){const t=document.currentScript;return t?.getAttribute("data-client-id")||""}checkConsent(){const t=this.getFromStorage(u);this.hasConsent="true"===t||"false"!==t}getOrCreateVisitorId(){let t=this.getFromStorage(c);return t||(t=n(),this.hasConsent&&this.saveToStorage(c,t)),t}saveToStorage(t,e){if(this.hasConsent){console.log("Saving to storage:",{key:t,value:e});try{localStorage.setItem(t,e),console.log("Successfully saved to localStorage")}catch(i){console.log("localStorage failed, falling back to cookies:",i),h.set(t,e,{expires:30,sameSite:"Lax"})}}}getFromStorage(t){console.log("Getting from storage:",t);try{const e=localStorage.getItem(t);if(e)return console.log("Found in localStorage:",e),e}catch(t){console.log("localStorage access failed:",t)}const e=h.get(t);return console.log("Cookie value:",e),e||null}captureUrlParams(){const t=new URLSearchParams(window.location.search),e={};["source","medium","campaign","content","term"].forEach((i=>{const r=t.get(`utm_${i}`);r&&(e[i]=r)})),this.utmParams=e;const i={};["fbclid","gclid","ttclid","msclkid"].forEach((e=>{const r=t.get(e);r&&(i[e]=r)})),this.clickIds=i,this.hasConsent&&(Object.keys(this.utmParams).length>0&&this.saveToStorage(`${a}utm`,JSON.stringify(this.utmParams)),Object.keys(this.clickIds).length>0&&this.saveToStorage(`${a}click_ids`,JSON.stringify(this.clickIds)))}setupFormListeners(){document.addEventListener("submit",(async t=>{const e=t.target;if(!(e&&e instanceof HTMLFormElement))return;const i=e.querySelector('input[type="email"], input[name="email"], input[name*="email"]');if(i?.value){const t=await this.hashEmail(i.value.trim().toLowerCase());this.trackEvent("form_submit",t)}})),document.addEventListener("click",(t=>{const e=t.target;(e.matches('[data-checkout="true"], .checkout-button, #checkout')||e.closest('[data-checkout="true"], .checkout-button, #checkout'))&&this.trackEvent("checkout_click")}))}async hashEmail(t){return(void 0)(t)}trackPageView(){this.trackEvent("page_view")}trackEvent(t,e){if(!this.hasConsent)return;const i={client_id:this.clientId,visitor_id:this.visitorId,event_type:t,timestamp:(new Date).toISOString(),page_url:window.location.href,referrer:document.referrer||void 0,utm_params:Object.keys(this.utmParams).length>0?this.utmParams:void 0,click_ids:Object.keys(this.clickIds).length>0?this.clickIds:void 0};e&&(i.email_hash=e),this.sendEvent(i)}sendEvent(t){if(console.log("Sending event:",t),navigator.sendBeacon){console.log("Using sendBeacon API");const e=new Blob([JSON.stringify(t)],{type:"application/json"}),i=navigator.sendBeacon(l,e);console.log("sendBeacon result:",i)}else console.log("Using fetch API"),fetch(l,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t),keepalive:!0}).then((t=>t.ok?t.json():t.text().then((e=>{throw console.error("Event API error:",{status:t.status,statusText:t.statusText,body:e}),new Error(`HTTP error! status: ${t.status}`)})))).then((t=>{console.log("Event API response:",t)})).catch((t=>{console.error("Failed to send event:",t)}))}trackConversion(t,e,i){if(!this.hasConsent)return;const r={client_id:this.clientId,visitor_id:this.visitorId,event_type:"conversion",timestamp:(new Date).toISOString(),page_url:window.location.href,utm_params:Object.keys(this.utmParams).length>0?this.utmParams:void 0,click_ids:Object.keys(this.clickIds).length>0?this.clickIds:void 0};this.sendEvent(r),fetch(`${l}/conversion`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({...r,conversion_type:t,value:e,currency:i}),keepalive:!0}).catch((t=>{console.error("Failed to send conversion event:",t)}))}setConsent(t){this.hasConsent=t,this.saveToStorage(u,t.toString()),t&&this.saveToStorage(c,this.visitorId)}};return window.gTracker=f,f}();
//# sourceMappingURL=tracker.js.map
